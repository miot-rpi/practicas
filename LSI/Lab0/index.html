<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Laboratorio 0 - RPI-I / RPI-II / LSI</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">RPI-I / RPI-II / LSI</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Calendario</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">LSI <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li class="active">
    <a href="./">Laboratorio 0</a>
</li>
                                    
<li >
    <a href="../Lab1/">Laboratorio 1</a>
</li>
                                    
<li >
    <a href="../Lab2/">Laboratorio 2</a>
</li>
                                    
<li >
    <a href="../Lab3/">Laboratorio 3</a>
</li>
                                    
<li >
    <a href="../Lab4/">Laboratorio 4</a>
</li>
                                    
<li >
    <a href="../Lab5/">Laboratorio 5</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">RPI-I <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../RPI-I/P1/">Práctica 1</a>
</li>
                                    
<li >
    <a href="../../RPI-I/P2/">Práctica 2</a>
</li>
                                    
<li >
    <a href="../../RPI-I/P3/">Práctica 3</a>
</li>
                                    
<li >
    <a href="../../RPI-I/P4/">Práctica 4</a>
</li>
                                    
<li >
    <a href="../../RPI-I/P5/">Práctica 5</a>
</li>
                                    
<li >
    <a href="../../RPI-I/P6/">Práctica 6</a>
</li>
                                    
<li >
    <a href="../../RPI-I/P7/">Práctica 7</a>
</li>
                                    
<li >
    <a href="../../RPI-I/P8/">Práctica 8</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">RPI-II <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../RPI-II/P1/">Práctica 1</a>
</li>
                                    
<li >
    <a href="../../RPI-II/P2/">Práctica 2</a>
</li>
                                    
<li >
    <a href="../../RPI-II/P3/">Práctica 3</a>
</li>
                                    
<li >
    <a href="../../RPI-II/P4/">Práctica 4</a>
</li>
                                    
<li >
    <a href="../../RPI-II/P5/">Práctica 5</a>
</li>
                                    
<li >
    <a href="../../RPI-II/P6/">Práctica 6 (I)</a>
</li>
                                    
<li >
    <a href="../../RPI-II/P6-II/">Práctica 6 (II)</a>
</li>
                                    
<li >
    <a href="../../RPI-II/P7/">Práctica 7</a>
</li>
                                    
<li >
    <a href="../../RPI-II/P8/">Práctica 8</a>
</li>
                                    
<li >
    <a href="../../RPI-II/P9/">Práctica 9</a>
</li>
                                    
<li >
    <a href="../../RPI-II/P10/">Práctica 10</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../..">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../Lab1/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#laboratorio-0-entorno-experimental">Laboratorio 0. Entorno experimental</a></li>
            <li><a href="#objetivos">Objetivos</a></li>
            <li><a href="#introduccion">Introducción</a></li>
            <li><a href="#preparacion-sd">Preparación SD</a></li>
            <li><a href="#conexion-arranque-y-configuracion">Conexión, arranque y configuración</a></li>
            <li><a href="#demos-basicas">Demos básicas</a></li>
            <li><a href="#demo-google-coral">Demo Google Coral</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="laboratorio-0-entorno-experimental">Laboratorio 0. Entorno experimental</h1>
<h2 id="objetivos">Objetivos</h2>
<ul>
<li>Preparar el entorno experimental.</li>
<li>Completar la configuración del sistema.</li>
<li>Probar el correcto funcionamiento tanto del Software como del Hardware.</li>
<li>Demostrar la capacidad de procesamiento tanto de la placa Raspberry Pi como del acelerador EdgeTPU de Google.</li>
</ul>
<h2 id="introduccion">Introducción</h2>
<p>El entorno experimental que se va a emplear en esta parte de la asignatura está compuesto de los siguientes elementos:</p>
<ul>
<li>Hardware</li>
<li>Kit Raspberry Pi 4<ul>
<li>Placa Raspberry Pi 4 con un SoC Broadcom BCM2711 con las siguientes características: Quad core de Cortex-A72, ARM v8 de 64-bit, @1.5GHz (+ <a href="https://www.raspberrypi.org/products/raspberry-pi-4-model-b/specifications/">info</a>) </li>
<li>Alimentador USB-C</li>
<li>Cable micro-HDMI a HDMI</li>
<li>Tarjeta uSD de alta velocidad</li>
</ul>
</li>
<li>Kit aceleración<ul>
<li>Acelerador Coral USB (+ <a href="https://coral.ai/products/accelerator/">info</a> )</li>
<li>Cámara para Raspberry Pi v2</li>
</ul>
</li>
<li>Software</li>
<li>Raspbian OS 64 bits - Distribución Linux basada en Debian adaptada a la Raspberry Pi en su versión de 64 bits (beta)</li>
<li>OpenCV 4.5.1 - Librería de visión por computador</li>
<li>TensorFlow 2.4 - Librería de Aprendizaje Máquina<ul>
<li>TensorFlowLite - versión para sistemas <em>Edge/Mobile</em></li>
</ul>
</li>
</ul>
<p>A continuación se proporcionan las instrucciones para configurar y probar el entorno experimental.</p>
<h2 id="preparacion-sd">Preparación SD</h2>
<p>Para simplificar el proceso de instalación se proporciona una imagen comprimida del sistema operativo con el software necesario pre-instalado. No obstante, si alguien desea realizar el proceso de instalación completo por su cuenta, puede seguir las instrucciones de la web de <a href="https://qengineering.eu">Q-engineering</a>, que suelen ser bastante completas y actualizadas.</p>
<p>A continuación se detallan los pasos a seguir para grabar la imagen de la tarjeta SD que hemos preparado..</p>
<ol>
<li>Descargar e instalar un programa para <em>flashear</em> tarjetas SD:<ul>
<li><a href="https://www.raspberrypi.org/software/">Raspberry Pi Imager</a> (recomendado)</li>
<li><a href="https://www.balena.io/etcher/">BalenaEtcher</a></li>
</ul>
</li>
<li>Descargar la imagen comprimida del siguiente enlace<ul>
<li><a href="https://drive.google.com/file/d/1Vw_eOVQ2Qp27sQwxeMgkWiMxlPyKcEN1/view?usp=sharing">lsi-rpi4-img.gz</a></li>
<li>Nota: Alternativamente cabría la posibilidad de usar la imagen que ofrece Q-engineering en su repositorio de GitHub:<ul>
<li><a href="https://github.com/Qengineering/RPi-image">A Raspberry Pi 4 64-bit OS image of several frameworks and deep-learning examples</a></li>
</ul>
</li>
</ul>
</li>
<li>Empleado un lector/escritor de tarjetas SD escribir la imagen a disco:
    <img alt="Raspberry Pi Imager" src="image-20210412232727709.png" /> <ul>
<li>Seleccionar la tarjeta SD sobre la que se desea escribir (64GB)</li>
<li>Seleccionar sistema operativo: <em>"Use custom"</em> y localizar el fichero de la imagen comprimida previamente descargada (no es necesario descomprimirla previamente)
<img alt="Choose OS" src="image-20210412233000832.png" /></li>
<li>Realizar la escritura (puede tardar bastantes minutos)
<img alt="Write" src="image-20210412233636340.png" /></li>
</ul>
</li>
</ol>
<h2 id="conexion-arranque-y-configuracion">Conexión, arranque y configuración</h2>
<ol>
<li>Realizar la conexión de los dispositivos<ul>
<li>Conectar el teclado y el ratón a los puertos USB 2.0, dejando al menos uno de los puertos USB 3.0 libre para el acelerador Google Coral (tienen un remate azul)</li>
<li>Conectar el monitor mediante el cable micro-HDMI a HDMI
    <img alt="micro HDMI cable" src="https://img.pccomponentes.com/articles/22/221646/k1481-1.jpg" /></li>
<li>Insertar la tarjeta SD grabada previamente</li>
<li>Conectar la cámara <em>"Raspberry Pi Camera Module v2"</em> (sensor Sony IMX219, interfaz CSI-2, resolución 3280 x 2464 píxeles, 30fps)
    <img alt="Pi Camera v2" src="https://www.raspberrypi.org/homepage-9df4b/static/1253242e1a7766dbc0af51edcf1a43a1/ae23f/ccfc5f9d175e980d1ec193d73797ef95a926ff7b_pi-camera-attached-1-1390x1080.jpg" /></li>
<li>Para información más precisa de la conexión se puede consultar el siguiente <a href="https://youtu.be/tub4zexVkqE">video.</a></li>
</ul>
</li>
<li>Conectar alimentación (cable USB-C) y comprobar el correcto arranque del equipo</li>
<li>Acceder a la Wifi con SSID=UCM y con las credenciales UCM propias<ul>
<li>El procedimiento es análogo a cualquier otro computador, se accede a la wifi y posteriormente se abre un navegador y  se introducen las credenciales (+ <a href="https://ssii.ucm.es/ucm">info</a>)
<img alt="WiFi UCM" src="https://ssii.ucm.es/data/cont/media/www/pag-6768/caratula%20UCM%20g.jpg" /></li>
</ul>
</li>
<li>Configurar la raspi con la utilidad <code>raspi-config</code></li>
</ol>
<pre><code class="language-bash">    sudo raspi-config
</code></pre>
<ul>
<li>Opciones del sistema
    <img alt="Opciones sistema" src="image-20210413000234657.png" /><ul>
<li>S3- Clave usuario <code>pi</code>
    <img alt="Nombre usuario" src="image-20210413000356479.png" /></li>
<li>S4 - Nombre del equipo</li>
</ul>
</li>
<li>Opciones de interfaz
    <img alt="Opciones interfaz" src="image-20210413001135185.png" /><ul>
<li>P1 - Activar cámara</li>
<li>P2 - Activar SSH para conexión remota</li>
<li>P3 - Activar VNC (opcional)</li>
</ul>
</li>
<li>Finalizar y reiniciar el equipo</li>
</ul>
<h2 id="demos-basicas">Demos básicas</h2>
<ul>
<li>Comprobar la correcta detección de la cámara</li>
</ul>
<pre><code class="language-bash">    $ vcgencmd get_camera
    supported=1 detected=1
</code></pre>
<ul>
<li>Comprobar temperatura (opcional)</li>
</ul>
<pre><code class="language-bash">    $ vcgencmd measure_temp
    temp=39.9'C
</code></pre>
<ul>
<li>Probar un ejemplo completo (cámara + OpenCV + TensorFlowLite)<ul>
<li>El siguiente ejemplo de <em>Qengineering</em> ilustra realizar una segmentación de imáganes empleado el modelo DeepLab v3 (fuente: <a href="https://github.com/Qengineering/TensorFlow_Lite_Segmentation_RPi_64-bit">github</a>)</li>
</ul>
</li>
</ul>
<pre><code class="language-bash">    cd ~/Test/TensorFlow_Lite_Segmentation_RPi_64-bit
    bin/Release/TestUnet
</code></pre>
<p><img alt="output image" src="https://camo.githubusercontent.com/25f64d9aa42084c3b9d766e5d883452cc8b652286b5a0b50bd1437c6b68156b3/68747470733a2f2f71656e67696e656572696e672e65752f696d616765732f556e65745f36342e6a7067" />]</p>
<ul>
<li>Otros ejemplos precompiladosde <em>Qengineering</em> <ul>
<li><code>TensorFlow_Lite_Pose_RPi_64-bits</code>: detección de postura corporal</li>
<li><code>TensorFlow_Lite_SSD_RPi_64-bits</code>: detección de objetos</li>
<li>Nota:<ul>
<li>Se trata de proyectos CodeBlocks, para compilarlos de nuevo es preciso abrir el correspondiente proyecto (<code>*.cbp</code>)</li>
<li>En ambos casos utilizan videos en lugar de captura de cámara.</li>
<li>Para usar la cámara es preciso modificar la línea <code>VideoCapture(0);</code> y recompilar el proyecto.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="demo-google-coral">Demo Google Coral</h2>
<h3 id="configuracion-necesaria-para-usar-el-acelerador-google-coral">Configuración necesaria para usar el acelerador Google Coral</h3>
<ul>
<li>Añadir usuario <code>pi</code> al grupo <code>plugdev</code> (para no tener que ejecutar los programas como <code>root</code>)</li>
</ul>
<pre><code class="language-bash">    sudo usermod -aG plugdev $USER
</code></pre>
<ul>
<li>Instalar las fuentes de paquetes.</li>
</ul>
<pre><code class="language-bash">    echo &quot;deb https://packages.cloud.google.com/apt coral-edgetpu-stable main&quot; | sudo tee \
        /etc/apt/sources.list.d/coral-edgetpu.list
    curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
    sudo apt-get update
</code></pre>
<ul>
<li>Instalar la librería de soporte, para la que hay dos opciones incompatibles <code>libedgetpu1-std</code> y <code>libedgetpu1-max</code> (máxima frecuencia y temperatura):</li>
</ul>
<pre><code class="language-bash">    sudo apt-get install libedgetpu1-max
</code></pre>
<h3 id="demo">Demo</h3>
<p>En el directorio <code>~/Test/TensorFlow-Lite-Object-Detection-on-Android-and-Raspberry-Pi</code> se proporciona un ejemplo de uso del acelerador Google Coral (fuente: <a href="https://github.com/EdjeElectronics/TensorFlow-Lite-Object-Detection-on-Android-and-Raspberry-Pi/blob/master/Raspberry_Pi_Guide.md">github</a>) a continuación se indican las instrucciones para probarlo:</p>
<h4 id="sin-edgetpu-ie-google-coral">Sín EdgeTPU (i.e. Google Coral):</h4>
<pre><code class="language-bash">    cd ~/Tests/TensorFlow-Lite-Object-Detection-on-Android-and-Raspberry-Pi
    python3 TFLite_detection_webcam.py --modeldir=Sample_TFLite_model
</code></pre>
<h4 id="con-edgetpu">Con EdgeTPU:</h4>
<ul>
<li>Añadir usuario <code>pi</code> al grupo <code>plugdev</code> (para no tener que ejecutar el script como <code>root</code>):</li>
</ul>
<pre><code class="language-bash">    sudo usermod -aG plugdev $USER
</code></pre>
<ul>
<li>Descarga modelo específico:</li>
</ul>
<pre><code class="language-bash">    wget    https://dl.google.com/coral/canned_models/mobilenet_ssd_v2_coco_quant_postprocess_edgetpu.tflite         
    mv mobilenet_ssd_v2_coco_quant_postprocess_edgetpu.tflite Sample_TFLite_model/edgetpu.tflite
</code></pre>
<ul>
<li>Conectar EdgeTPU a un puerto USB 3.0.</li>
<li>Ejecutar la versión EdgeTPU</li>
</ul>
<pre><code class="language-bash">    python3 TFLite_detection_webcam.py --modeldir=Sample_TFLite_model --edgetpu
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
